version: "3.8"

services:
  db:
    image: postgres:13.0-alpine
    container_name: mound_city_postgress_db
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_DB=mound_city
      - POSTGRES_PASSWORD=password
    volumes:
      - ./pgdata:/var/lib/postgresql/data
    ports:
      - "5433:5432"

  admin:
    image: dpage/pgadmin4
    container_name: mound_city_db_admin
    ports:
      - "5454:5454/tcp"
    depends_on:
      - db
    environment:
      - PGADMIN_DEFAULT_EMAIL=atwilliams88@gmail.com
      - PGADMIN_DEFAULT_PASSWORD=password
      - PGAMIN_LISTEN_PORT=5454

  web:
    image: express-starter
    container_name: mound_city_express_app
    volumes:
      - ./logs/combined.log:/logs/combined.log
      - ./logs/error.log:/logs/error.log
    deploy:
      restart_policy:
        condition: on-failure
    environment:
      - PORT=3000
      - PGUSER=postgres
      - PGPORT=5432;
      - PGDATABASE=mound_city
      - PGPASSWORD=password
      - PGHOST=db
    depends_on:
      - db
      - admin
    ports:
      - "3000:3000"
